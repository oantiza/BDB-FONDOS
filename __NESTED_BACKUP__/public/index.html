<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Terminal | Global CIO Office</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="h-screen flex flex-col overflow-hidden bg-gray-100 font-roboto text-slate-800">

    <div id="formulario-acceso" class="fixed inset-0 z-[100] bg-[#0B2545] flex items-center justify-center p-4">
        <div class="bg-white w-96 p-8 rounded shadow-2xl border-t-4 border-[#D4AF37]">
            <h2 class="text-3xl font-bold text-center mb-6 font-serif text-[#0B2545]">Nexus Terminal</h2>
            <input type="email" id="email" class="w-full border-b-2 p-3 mb-3 outline-none focus:border-[#D4AF37]" placeholder="Usuario">
            <input type="password" id="password" class="w-full border-b-2 p-3 mb-6 outline-none focus:border-[#D4AF37]" placeholder="Clave">
            <button onclick="login()" class="w-full bg-[#0B2545] text-white py-3 font-bold hover:bg-[#153e6e] transition-colors">ENTRAR</button>
        </div>
    </div>

    <div id="contenido-protegido" class="hidden flex-1 flex flex-col h-full">
        <header class="h-16 bg-[#0B2545] text-white flex items-center justify-between px-6 shadow-lg border-b border-[#D4AF37] z-20 shrink-0">
            <div class="flex flex-col">
                <div class="font-serif text-xl font-bold">Global <span class="text-[#D4AF37]">CIO</span> Office</div>
                <div class="text-[9px] uppercase tracking-[0.2em] text-gray-400">Portfolio Intelligence</div>
            </div>
            <div class="flex items-center gap-6">
                <button id="btn-news-bell" class="font-bold hover:text-[#D4AF37] transition-colors flex items-center gap-2">
                    <span>NEWS</span>
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[#D4AF37] opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-[#D4AF37]"></span>
                    </span>
                </button>
                <button onclick="logout()" class="border px-3 py-1 rounded hover:bg-white hover:text-[#0B2545] transition-colors text-xs font-bold uppercase">Salir</button>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden">
            <div class="w-80 bg-white border-r shadow-md z-10 p-0 flex flex-col shrink-0">
                <div class="p-3 bg-slate-50 font-serif font-bold text-[#0B2545] border-b text-sm">Universo de Fondos</div>
                <div class="p-3 border-b">
                    <input type="text" id="fund-search" placeholder="Buscar nombre o ISIN..." class="w-full text-xs p-2 border rounded shadow-inner outline-none focus:border-[#0B2545] transition-colors">
                </div>
                <div id="main-grid-container" class="flex-1 overflow-y-auto scrollbar-thin"></div>
            </div>

            <main class="flex-1 bg-[#F3F4F6] p-6 overflow-hidden">
                <div class="grid grid-cols-12 gap-6 h-full">
                    
                    <div class="col-span-8 flex flex-col gap-6 h-full overflow-hidden">
                        
                        <div class="grid grid-cols-2 gap-4 h-80 shrink-0">
                            <div class="bg-white rounded shadow-md p-4 flex flex-col border-t-4 border-[#0B2545] relative">
                                <div class="flex justify-between items-center mb-2 z-20">
                                    <h3 class="font-serif font-bold text-[#0B2545] text-sm flex items-center gap-2">üìà Renta Variable</h3>
                                    <select id="market-index-selector" class="text-[10px] border border-slate-200 rounded py-1 px-2 bg-slate-50 outline-none focus:border-[#D4AF37] font-bold text-slate-600 cursor-pointer hover:bg-white transition-colors">
                                        <option value="GSPC.INDX">üá∫üá∏ S&P 500</option>
                                        <option value="IXIC.INDX">üá∫üá∏ Nasdaq 100</option>
                                        <option value="STOXX50E.INDX">üá™üá∫ Euro Stoxx 50</option>
                                        <option value="GDAXI.INDX">üá©üá™ DAX 40</option>
                                        <option value="IBEX.INDX">üá™üá∏ IBEX 35</option>
                                    </select>
                                </div>
                                <div class="flex-1 relative w-full min-h-0">
                                    <div id="loader-market" class="absolute inset-0 flex items-center justify-center bg-white/80 z-10 transition-opacity"><span class="animate-spin text-xl">‚è≥</span></div>
                                    <canvas id="chart-market-index"></canvas>
                                </div>
                            </div>

                            <div class="bg-white rounded shadow-md p-4 flex flex-col border-t-4 border-[#D4AF37] relative">
                                <div class="flex justify-between items-center mb-2 z-20">
                                    <h3 class="font-serif font-bold text-[#0B2545] text-sm flex items-center gap-2">üè¶ Curva de Tipos</h3>
                                    <select id="yield-curve-selector" class="text-[10px] border border-slate-200 rounded py-1 px-2 bg-slate-50 outline-none focus:border-[#D4AF37] font-bold text-slate-600 cursor-pointer hover:bg-white transition-colors">
                                        <option value="US">üá∫üá∏ Estados Unidos</option>
                                        <option value="EU">üá™üá∫ Europa (Bunds)</option>
                                    </select>
                                </div>
                                <div class="flex-1 relative w-full min-h-0">
                                    <div id="loader-yield" class="absolute inset-0 flex items-center justify-center bg-white/80 z-10 transition-opacity"><span class="animate-spin text-xl">‚è≥</span></div>
                                    <canvas id="chart-yield-curve"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 bg-white rounded shadow-md border-t-4 border-[#D4AF37] flex flex-col min-h-0 overflow-hidden">
                            <div class="p-3 bg-[#0B2545] text-white flex justify-between items-center shrink-0">
                                <span class="font-bold">Composici√≥n de Cartera</span>
                                <div class="text-xs">Total: <input type="number" id="investment_amount" value="100000" class="bg-transparent w-24 text-right text-[#D4AF37] font-bold outline-none border-b border-[#D4AF37]"> ‚Ç¨</div>
                            </div>
                            <div class="flex-1 overflow-y-auto scrollbar-thin p-0">
                                <table class="w-full text-left text-xs">
                                    <tbody id="portfolio-table-body" class="divide-y divide-slate-50"></tbody>
                                </table>
                            </div>
                            <div class="p-2 bg-slate-50 text-right text-xs font-bold border-t text-slate-700 shrink-0">
                                Peso: <span id="footer-total-weight">0%</span> | Valor: <span id="footer-total-amount">0 ‚Ç¨</span>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-4 flex flex-col gap-6 h-full overflow-y-auto scrollbar-thin pb-2">
                        
                        <div class="bg-white rounded shadow-md p-6 border-l-4 border-[#10B981] shrink-0">
                            <h3 class="font-bold text-[#0B2545] mb-4">An√°lisis Instant√°neo</h3>
                            
                            <div class="grid grid-cols-2 gap-2 h-32 mb-4">
                                <div class="relative"><canvas id="asset-allocation-chart"></canvas></div>
                                <div class="relative"><canvas id="geo-distribution-chart"></canvas></div>
                            </div>

                            <div class="bg-slate-50 p-3 rounded border mb-4">
                                <div class="flex justify-between items-center mb-2"><span class="text-[9px] font-bold text-slate-500 uppercase">Style Box (RV)</span><span id="style-box-label" class="text-[9px] font-bold text-[#0B2545]">-</span></div>
                                <div id="style-box-grid" class="grid grid-cols-3 gap-1 h-24 w-24 mx-auto"></div>
                            </div>
                            <div class="grid grid-cols-3 gap-2 text-center text-xs">
                                <div class="bg-slate-50 p-2 rounded"><div class="text-slate-500 uppercase text-[9px]">Volatilidad</div><div id="mini-volatility" class="font-bold text-slate-800">-</div></div>
                                <div class="bg-slate-50 p-2 rounded"><div class="text-slate-500 uppercase text-[9px]">Retorno</div><div id="mini-return" class="font-bold text-emerald-600">-</div></div>
                                <div class="bg-slate-50 p-2 rounded"><div class="text-slate-500 uppercase text-[9px]">Sharpe</div><div id="mini-sharpe" class="font-bold text-[#D4AF37]">-</div></div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded shadow-md p-6 border-l-4 border-[#0B2545] shrink-0">
                            <h3 class="font-bold text-[#0B2545] mb-4">Estrategia & Control</h3>
                            <div class="mb-5 pb-4 border-b border-dashed border-slate-200">
                                <input type="file" id="csv-upload" accept=".csv" class="hidden">
                                <button onclick="document.getElementById('csv-upload').click()" class="w-full bg-slate-50 border border-slate-300 text-slate-600 text-xs font-bold py-2 rounded hover:text-[#0B2545] hover:border-[#0B2545] flex justify-center gap-2 items-center transition-colors">Importar CSV</button>
                            </div>
                            <form id="portfolio-form" class="space-y-4">
                                <div><div class="flex justify-between text-xs font-bold mb-1 text-slate-600"><span>Perfil de Riesgo</span><span id="risk-display" class="bg-[#0B2545] text-white px-2 rounded">5</span></div><input type="range" id="risk_level" min="1" max="10" value="5" class="w-full accent-[#0B2545] cursor-pointer"></div>
                                <div><label class="text-xs font-bold mb-1 block text-slate-600">N¬∫ Activos</label><input type="number" id="number_of_funds" value="5" class="w-full border p-2 rounded text-xs outline-none focus:border-[#D4AF37]"></div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button type="button" id="btn-open-tactical" class="border text-slate-600 hover:text-[#0B2545] font-bold py-2 rounded text-xs bg-white">‚öô T√°ctica</button>
                                    <button type="button" id="btn-open-vip-tool" onclick="window.openVipModal()" class="border text-slate-600 hover:text-[#0B2545] font-bold py-2 rounded text-xs bg-white">‚òÖ Lista VIP</button>
                                </div>
                                <div class="pt-2 border-t mt-2">
                                    <button type="button" id="btn-optimize" class="w-full bg-gradient-to-r from-[#D4AF37] to-[#b8952b] text-[#0B2545] text-xs font-bold uppercase py-3 rounded shadow mb-2">‚ö° Optimizar Cartera</button>
                                    <button type="submit" class="w-full bg-[#0B2545] text-white text-xs font-bold uppercase py-3 rounded shadow">Generar Manual</button>
                                </div>
                            </form>
                            <div class="grid grid-cols-2 gap-2 mt-4">
                                <button id="run-backtest-btn" class="border py-2 text-xs font-bold rounded hover:bg-slate-50 text-slate-600">üìä X-Ray</button>
                                <button id="btn-open-costs-tool" class="border py-2 text-xs font-bold rounded hover:bg-slate-50 text-slate-600">üí∞ Costes</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="advanced-editor-modal" class="hidden fixed inset-0 z-[60] bg-[#0f172a]/95 backdrop-blur-md items-center justify-center font-roboto">
        <div class="bg-[#F8FAFC] w-[95vw] h-[95vh] max-w-[1800px] rounded-xl shadow-2xl flex flex-col overflow-hidden border border-slate-700">
            <div class="bg-white px-6 py-3 flex justify-between items-center shrink-0 border-b border-slate-200 shadow-sm z-20">
                <div class="flex items-center gap-4">
                    <div class="bg-[#0B2545] text-white p-1.5 rounded"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div>
                    <div><h3 class="font-serif font-bold text-lg text-[#0B2545] leading-none">Workspace de Rebalanceo</h3><p class="text-[10px] text-slate-400 font-mono mt-0.5">OPTIMIZACI√ìN T√ÅCTICA & EJECUCI√ìN</p></div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right"><div class="text-[9px] font-bold text-slate-400 uppercase">Impacto Estimado</div><div id="turnover-display" class="font-mono text-sm font-bold text-[#0B2545]">0‚Ç¨ Vol.</div></div>
                    <div class="h-8 w-px bg-slate-200"></div>
                    <button onclick="closeModal('advanced-editor-modal')" class="text-slate-400 hover:text-rose-500 transition-colors text-3xl leading-none">&times;</button>
                </div>
            </div>
            <div class="h-[40%] shrink-0 flex border-b border-slate-200 bg-white z-10">
                <div class="w-[30%] border-r border-slate-100 p-6 flex flex-col justify-center bg-slate-50/30">
                    <h4 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6 border-b pb-2">M√©tricas de Impacto</h4>
                    <div class="space-y-6">
                        <div class="flex justify-between items-end group"><div class="flex flex-col"><span class="text-[10px] font-bold text-slate-400 uppercase mb-1">Retorno Esperado</span><div class="flex items-baseline gap-2"><span class="text-3xl font-mono font-bold text-[#0B2545]" id="delta-ret-val">-</span><span class="text-xs font-bold px-2 py-0.5 rounded shadow-sm" id="delta-ret-diff">-</span></div></div></div>
                        <div class="flex justify-between items-end group"><div class="flex flex-col"><span class="text-[10px] font-bold text-slate-400 uppercase mb-1">Volatilidad (Riesgo)</span><div class="flex items-baseline gap-2"><span class="text-3xl font-mono font-bold text-[#0B2545]" id="delta-vol-val">-</span><span class="text-xs font-bold px-2 py-0.5 rounded shadow-sm" id="delta-vol-diff">-</span></div></div></div>
                        <div class="flex justify-between items-end group"><div class="flex flex-col"><span class="text-[10px] font-bold text-slate-400 uppercase mb-1">Ratio Sharpe</span><div class="flex items-baseline gap-2"><span class="text-3xl font-mono font-bold text-[#0B2545]" id="delta-sharpe-val">-</span><span class="text-xs font-bold px-2 py-0.5 rounded shadow-sm" id="delta-sharpe-diff">-</span></div></div></div>
                    </div>
                </div>
                <div class="flex-1 p-4 relative flex flex-col">
                    <div class="flex justify-between items-center mb-2 px-2"><h4 class="text-xs font-bold text-[#0B2545] uppercase tracking-widest">Proyecci√≥n de Patrimonio (5 A√±os)</h4><div class="flex gap-4"><span class="flex items-center gap-1 text-[10px] text-slate-400 font-bold"><span class="w-2 h-2 bg-slate-300 rounded-full"></span> Actual</span><span class="flex items-center gap-1 text-[10px] text-[#0B2545] font-bold"><span class="w-2 h-2 bg-[#0B2545] rounded-full"></span> Objetivo</span></div></div>
                    <div class="flex-1 relative w-full min-h-0 bg-gradient-to-b from-white to-slate-50 rounded border border-slate-100 p-2 shadow-inner"><canvas id="editor-live-chart"></canvas></div>
                </div>
            </div>
            <div class="flex-1 flex min-h-0 bg-[#F1F5F9]">
                <div class="flex-1 flex flex-col border-r border-slate-200 bg-slate-100/50">
                    <div class="p-2 bg-slate-200/50 border-b border-slate-200 flex justify-between items-center"><span class="font-bold text-xs text-slate-500 uppercase tracking-wider ml-2">Cartera Origen</span><span class="text-[9px] bg-slate-300 text-slate-600 px-2 py-0.5 rounded font-mono font-bold mr-2">READ ONLY</span></div>
                    <div class="flex-1 overflow-y-auto scrollbar-thin"><table class="w-full text-left text-xs"><thead class="bg-slate-100 text-slate-400 font-bold text-[9px] uppercase sticky top-0 z-10 shadow-sm"><tr><th class="py-2 pl-4">Fondo</th><th class="py-2 text-right pr-4">Peso</th></tr></thead><tbody id="editor-original-tbody" class="divide-y divide-slate-200 border-b border-slate-200"></tbody></table></div>
                </div>
                <div class="flex-[1.3] flex flex-col bg-white shadow-[0_0_50px_rgba(0,0,0,0.05)] z-10 relative">
                    <div class="p-2 border-b border-slate-100 bg-white flex gap-3 items-center shadow-sm z-20">
                        <div class="bg-[#0B2545] text-white px-3 py-1 rounded-sm text-[10px] font-bold uppercase tracking-wider ml-1">Objetivo</div><div class="h-4 w-px bg-slate-200"></div>
                        <div class="relative flex-1 group"><span class="absolute left-2 top-1.5 text-slate-400 group-focus-within:text-[#D4AF37]">üîç</span><input type="text" id="editor-add-fund-input" class="w-full pl-7 pr-2 py-1 text-xs bg-slate-50 border border-slate-200 rounded focus:outline-none focus:bg-white focus:border-[#D4AF37] transition-all" placeholder="A√±adir fondo..."><div id="editor-search-results" class="absolute left-0 right-0 top-9 bg-white shadow-xl border rounded-lg max-h-60 overflow-y-auto hidden z-50"></div></div>
                        <div class="h-4 w-px bg-slate-200"></div><span id="editor-total-weight-display" class="text-[10px] font-mono font-bold bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200">0%</span><button onclick="window.autoRebalance100()" class="text-[9px] bg-blue-50 text-blue-600 border border-blue-100 px-2 py-1 rounded font-bold hover:bg-blue-100 uppercase transition-colors mr-1">Auto 100%</button>
                    </div>
                    <div class="flex-1 overflow-y-auto scrollbar-thin"><table class="w-full text-left text-xs"><thead class="bg-slate-50 text-[#0B2545] font-bold text-[9px] uppercase sticky top-0 z-10 shadow-sm"><tr><th class="py-2 pl-4">Fondo / Activo</th><th class="py-2 text-right w-24">Peso</th><th class="py-2 text-center w-12">Acci√≥n</th></tr></thead><tbody id="editor-proposed-tbody" class="divide-y divide-slate-100"></tbody></table></div>
                    <div class="h-36 border-t border-slate-200 bg-slate-50 flex flex-col shadow-[0_-4px_20px_rgba(0,0,0,0.05)]"><div class="px-3 py-1.5 bg-slate-200/50 text-[9px] font-bold text-slate-500 uppercase border-b border-slate-200 flex justify-between"><span>Cola de √ìrdenes</span><span>Ejecuci√≥n Inmediata</span></div><div id="rebalancing-orders-container" class="flex-1 overflow-y-auto p-0 scrollbar-thin bg-white"></div><div class="p-2 bg-white border-t border-slate-100"><button id="btn-save-final-portfolio" class="w-full bg-[#0B2545] text-white font-bold h-10 rounded shadow hover:bg-[#153e6e] uppercase text-xs tracking-widest flex items-center justify-center gap-2 transition-all"><svg class="w-4 h-4 text-[#D4AF37]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Confirmar Rebalanceo</button></div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="news-modal" class="hidden fixed inset-0 z-50 bg-[#0B2545]/90 backdrop-blur-sm items-center justify-center font-roboto">
        <div class="bg-white w-full max-w-5xl h-[85vh] rounded-xl flex flex-col overflow-hidden shadow-2xl border border-slate-600">
            <div class="bg-[#0B2545] text-white p-4 flex justify-between items-center shrink-0 border-b border-[#D4AF37]">
                <div class="flex items-center gap-3"><span class="text-xl">üì∞</span><div><h3 class="font-serif font-bold text-lg leading-none">Financial News Wire</h3><p class="text-[10px] text-gray-400 uppercase tracking-wider mt-0.5">EODHD Real-time Feed</p></div></div>
                <button onclick="closeModal('news-modal')" class="text-gray-400 hover:text-white text-2xl transition-colors">&times;</button>
            </div>
            <div class="bg-slate-100 p-3 border-b border-slate-200 flex flex-wrap gap-4 items-center shrink-0">
                <div class="flex items-center gap-2"><label class="text-[10px] font-bold text-[#0B2545] uppercase">Filtro Macro:</label><div class="relative"><select id="news-macro-select" class="appearance-none bg-white border border-slate-300 text-slate-700 py-1.5 pl-3 pr-8 rounded text-xs font-bold focus:outline-none focus:border-[#D4AF37] shadow-sm"><option value="general">üåç Mercado General</option><option value="inflation">üìà IPC / Inflaci√≥n</option><option value="interest rates">üè¶ Tipos de Inter√©s</option><option value="gdp">üèóÔ∏è PIB / Econom√≠a</option><option value="employment">üë• Empleo / Laboral</option><option value="earnings">üí∞ Resultados (Earnings)</option></select><div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500"><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div></div>
                <div class="h-6 w-px bg-slate-300"></div>
                <div class="flex-1 flex gap-2 items-center"><div class="relative flex-1 max-w-xs group"><span class="absolute left-2.5 top-1.5 text-slate-400 group-focus-within:text-[#D4AF37]">üîç</span><input type="text" id="news-ticker-input" placeholder="Ticker o Empresa (ej. AAPL, Inditex)..." class="w-full pl-8 pr-3 py-1.5 text-xs border border-slate-300 rounded focus:outline-none focus:border-[#D4AF37] shadow-sm uppercase font-mono placeholder:normal-case placeholder:font-sans"></div><button id="btn-search-news" class="bg-[#0B2545] text-white px-4 py-1.5 rounded text-xs font-bold hover:bg-[#153e6e] shadow transition-colors uppercase tracking-wide">Buscar</button></div>
            </div>
            <div id="news-general-container" class="flex-1 overflow-y-auto p-6 bg-[#F3F4F6] space-y-4 scrollbar-thin"></div>
        </div>
    </div>

    <div id="analysis-modal" class="hidden fixed inset-0 z-50 bg-[#0B2545]/95 backdrop-blur-sm items-center justify-center font-roboto opacity-0 transition-opacity duration-300">
        <div class="bg-[#F8FAFC] w-full max-w-7xl h-[95vh] rounded-xl shadow-2xl flex flex-col overflow-hidden border border-slate-600">
            <div class="bg-[#0B2545] text-white px-6 py-4 flex justify-between items-center border-b border-[#D4AF37] shrink-0">
                <div class="flex items-center gap-3"><div class="p-2 bg-white/10 rounded"><svg class="w-6 h-6 text-[#D4AF37]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div><div><h3 class="font-serif font-bold text-xl leading-none">Informe X-Ray</h3><p class="text-[10px] text-slate-400 font-mono mt-0.5 uppercase tracking-widest">Diagn√≥stico Profundo de Cartera</p></div></div>
                <button onclick="closeModal('analysis-modal')" class="text-slate-400 hover:text-white text-3xl transition-colors">&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 space-y-6 scrollbar-thin bg-[#F1F5F9]">
                <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
                    <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                        <h4 class="font-bold text-[#0B2545] text-sm uppercase tracking-wide">Evoluci√≥n Hist√≥rica Comparada</h4>
                        <div class="flex items-center gap-4">
                            <div class="relative"><select id="xray-benchmark-selector" class="appearance-none bg-slate-50 border border-slate-200 text-xs font-bold text-slate-600 py-1.5 pl-3 pr-8 rounded focus:outline-none focus:border-[#D4AF37]" onchange="window.updateBenchmarkSelection(this.value)"><option value="conservative">üõ°Ô∏è Benchmark Conservador</option><option value="moderate" selected>‚öñÔ∏è Benchmark Moderado</option><option value="aggressive">üöÄ Benchmark Agresivo</option></select><div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-400"><svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div>
                            <div class="flex bg-slate-100 p-0.5 rounded border border-slate-200"><button id="btn-1y" onclick="window.updateXRayTimeframe('1Y')" class="px-3 py-1 text-[10px] font-bold rounded text-slate-500 hover:bg-white hover:shadow-sm transition-all">1Y</button><button id="btn-3y" onclick="window.updateXRayTimeframe('3Y')" class="px-3 py-1 text-[10px] font-bold rounded bg-white shadow text-[#0B2545]">3Y</button><button id="btn-5y" onclick="window.updateXRayTimeframe('5Y')" class="px-3 py-1 text-[10px] font-bold rounded text-slate-500 hover:bg-white hover:shadow-sm transition-all">5Y</button></div><input type="hidden" id="xray-period-input" value="3Y">
                        </div>
                    </div>
                    <div class="h-80 w-full p-4 relative"><canvas id="backtest-chart"></canvas></div>
                    <div class="grid grid-cols-4 divide-x divide-slate-100 border-t border-slate-100 bg-slate-50/50">
                        <div class="p-4 text-center group hover:bg-white transition-colors"><p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Retorno Anual (CAGR)</p><p id="metric-cagr" class="text-xl font-mono font-bold text-[#0B2545] group-hover:text-emerald-600 transition-colors">-</p></div>
                        <div class="p-4 text-center group hover:bg-white transition-colors"><p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Volatilidad (1Y)</p><p id="metric-volatility" class="text-xl font-mono font-bold text-[#0B2545] group-hover:text-rose-500 transition-colors">-</p></div>
                        <div class="p-4 text-center group hover:bg-white transition-colors"><p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Ratio Sharpe</p><p id="metric-sharpe" class="text-xl font-mono font-bold text-[#0B2545] group-hover:text-[#D4AF37] transition-colors">-</p></div>
                        <div class="p-4 text-center group hover:bg-white transition-colors"><p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Max Drawdown</p><p id="metric-maxdd" class="text-xl font-mono font-bold text-slate-500 group-hover:text-rose-600 transition-colors">-</p></div>
                    </div>
                </div>
                <div class="grid grid-cols-12 gap-6 h-96">
                    <div class="col-span-8 bg-white rounded-lg shadow-sm border border-slate-200 p-4 flex flex-col relative"><h4 class="font-bold text-[#0B2545] text-sm uppercase tracking-wide mb-2">Mapa de Eficiencia</h4><div class="flex-1 relative w-full h-full" id="riskPlot"></div></div>
                    <div class="col-span-4 bg-[#0B2545] rounded-lg shadow-lg border border-[#0B2545] p-6 text-white flex flex-col justify-center relative overflow-hidden"><div class="absolute -right-6 -bottom-6 text-white opacity-5"><svg class="w-48 h-48" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg></div><h4 class="font-serif text-lg font-bold text-[#D4AF37] mb-4 z-10">Interpretaci√≥n</h4><div class="space-y-4 text-xs font-light text-slate-300 leading-relaxed z-10"><p><strong class="text-white">Posici√≥n √ìptima:</strong> Esquina Superior Izquierda.</p><p><strong class="text-white">Tu Cartera:</strong> Punto Azul con borde Dorado.</p><div class="mt-4 pt-4 border-t border-white/10"><div class="flex items-center gap-2 mb-2"><span class="w-2 h-2 bg-emerald-500 rounded-full"></span> <span>Conservador</span></div><div class="flex items-center gap-2 mb-2"><span class="w-2 h-2 bg-blue-500 rounded-full"></span> <span>Moderado</span></div><div class="flex items-center gap-2"><span class="w-2 h-2 bg-rose-500 rounded-full"></span> <span>Agresivo</span></div></div></div></div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-4"><h4 class="font-bold text-[#0B2545] text-sm uppercase tracking-wide mb-4">Principales Posiciones Agregadas</h4><div id="top-holdings-container" class="grid grid-cols-5 gap-3"></div></div>
                <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6"><div class="flex justify-between items-center mb-6"><h4 class="font-bold text-[#0B2545] text-sm uppercase tracking-wide">Matriz de Correlaci√≥n</h4><span class="text-[10px] text-slate-400 bg-slate-100 px-2 py-1 rounded">Basado en retornos diarios (1 A√±o)</span></div><div id="correlation-matrix-container" class="w-full overflow-x-auto flex justify-center"></div></div>
            </div>
        </div>
    </div>

    <div id="comparison-modal" class="hidden fixed inset-0 z-50 bg-slate-900/95 backdrop-blur-sm items-center justify-center font-roboto"><div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl flex flex-col overflow-hidden m-4 border border-slate-200 transform transition-all scale-100"><div class="bg-[#0B2545] px-8 py-6 border-b-4 border-[#D4AF37] flex justify-between items-start relative overflow-hidden"><div class="absolute top-0 right-0 p-4 opacity-5"><svg class="w-32 h-32 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg></div><div class="relative z-10"><h3 class="font-serif text-2xl text-white font-bold tracking-wide mb-1">Propuesta de Optimizaci√≥n</h3><p class="text-blue-200 text-xs font-light tracking-wider uppercase opacity-80">An√°lisis de Impacto Proyectado</p></div><button onclick="closeModal('comparison-modal')" class="text-white/50 hover:text-white transition-colors text-2xl z-10">&times;</button></div><div class="p-8 bg-white"><div class="overflow-hidden rounded-lg border border-slate-100 shadow-sm"><table class="w-full text-sm"><thead><tr class="bg-slate-50 text-slate-400 text-[10px] uppercase tracking-[0.15em] font-bold border-b border-slate-100"><th class="py-4 px-6 text-left w-1/3">M√©trica (Anualizada)</th><th class="py-4 px-6 text-right w-1/4">Actual</th><th class="py-4 px-6 text-right w-1/4 text-[#0B2545]">Optimizada</th><th class="py-4 px-6 text-right w-1/6">Delta</th></tr></thead><tbody class="divide-y divide-slate-50"><tr class="group hover:bg-slate-50/50 transition-colors"><td class="py-4 px-6 font-medium text-slate-600">Retorno Esperado</td><td class="py-4 px-6 text-right font-mono text-slate-500" id="comp-cagr-old">-</td><td class="py-4 px-6 text-right font-mono font-bold text-[#0B2545] bg-[#0B2545]/5 group-hover:bg-[#0B2545]/10 transition-colors" id="comp-cagr-new">-</td><td class="py-4 px-6 text-right font-mono text-xs font-bold" id="comp-cagr-diff">-</td></tr><tr class="group hover:bg-slate-50/50 transition-colors"><td class="py-4 px-6 font-medium text-slate-600">Volatilidad (Riesgo)</td><td class="py-4 px-6 text-right font-mono text-slate-500" id="comp-vol-old">-</td><td class="py-4 px-6 text-right font-mono font-bold text-[#0B2545] bg-[#0B2545]/5 group-hover:bg-[#0B2545]/10 transition-colors" id="comp-vol-new">-</td><td class="py-4 px-6 text-right font-mono text-xs font-bold" id="comp-vol-diff">-</td></tr><tr class="group hover:bg-slate-50/50 transition-colors"><td class="py-4 px-6 font-medium text-slate-600">Ratio Sharpe</td><td class="py-4 px-6 text-right font-mono text-slate-500" id="comp-sharpe-old">-</td><td class="py-4 px-6 text-right font-mono font-bold text-[#0B2545] bg-[#0B2545]/5 group-hover:bg-[#0B2545]/10 transition-colors" id="comp-sharpe-new">-</td><td class="py-4 px-6 text-right font-mono text-xs font-bold" id="comp-sharpe-diff">-</td></tr><tr class="group hover:bg-slate-50/50 transition-colors"><td class="py-4 px-6 font-medium text-slate-600">Max Drawdown</td><td class="py-4 px-6 text-right font-mono text-slate-500" id="comp-mdd-old">-</td><td class="py-4 px-6 text-right font-mono font-bold text-[#0B2545] bg-[#0B2545]/5 group-hover:bg-[#0B2545]/10 transition-colors" id="comp-mdd-new">-</td><td class="py-4 px-6 text-right font-mono text-xs font-bold" id="comp-mdd-diff">-</td></tr></tbody></table></div><div class="mt-8 flex items-center gap-4"><div class="flex-1"><div class="flex justify-between text-[10px] text-slate-400 uppercase tracking-wider mb-2"><span>Estructura Actual</span><span>Estructura Propuesta</span></div><div class="h-2 flex gap-1 rounded-full overflow-hidden bg-slate-100"><div id="comp-bar-old" class="flex-1 flex opacity-50 grayscale"></div><div class="w-px bg-white"></div><div id="comp-bar-new" class="flex-1 flex shadow-inner"></div></div></div></div></div><div class="p-5 bg-slate-50 border-t border-slate-100 flex justify-between items-center"><button onclick="closeModal('comparison-modal')" class="text-slate-500 font-bold text-xs px-6 py-2 hover:text-rose-500 transition-colors uppercase tracking-wider">Descartar</button><button id="btn-accept-optimization" class="bg-[#0B2545] text-white px-8 py-3 rounded shadow-lg hover:bg-[#153e6e] hover:shadow-xl transition-all transform hover:-translate-y-0.5 text-xs font-bold uppercase tracking-widest flex items-center gap-2"><span>Aplicar Cambios</span><span class="text-[#D4AF37]">‚Üí</span></button></div></div></div>
    <div id="tactical-modal" class="hidden fixed inset-0 z-50 bg-[#0B2545]/90 backdrop-blur-sm items-center justify-center"><div class="bg-white w-full max-w-4xl rounded p-6 shadow-2xl relative"><button onclick="closeModal('tactical-modal')" class="absolute top-4 right-6 text-3xl text-slate-400">&times;</button><h3 class="font-bold text-[#0B2545] text-xl mb-6">T√°ctica</h3><button onclick="closeModal('tactical-modal')" class="bg-[#0B2545] text-white font-bold py-2 px-6 rounded">Guardar</button></div></div>
    <div id="vip-modal" class="hidden fixed inset-0 z-50 bg-[#0B2545]/90 backdrop-blur-sm items-center justify-center"><div class="bg-white w-full max-w-2xl rounded p-6 shadow-2xl relative"><button onclick="closeModal('vip-modal')" class="absolute top-4 right-6 text-3xl">&times;</button><h3 class="font-bold text-[#0B2545] text-xl mb-6">VIP</h3><div id="vip-list-container"></div><input type="text" id="vip-search-input" class="border p-2 w-full"><div id="vip-search-results"></div><button id="save-vips-btn" class="mt-4 bg-[#0B2545] text-white px-4 py-2 rounded">Guardar</button></div></div>
    <div id="costs-detail-modal" class="hidden fixed inset-0 z-50 bg-[#0B2545]/90 backdrop-blur-sm items-center justify-center"><div class="bg-white w-full max-w-3xl rounded-lg p-6 relative"><button onclick="closeModal('costs-detail-modal')" class="absolute top-2 right-4 text-2xl">&times;</button><div class="overflow-y-auto max-h-[60vh]"><table class="w-full text-xs"><tbody id="costs-table-body"></tbody></table><div class="flex justify-between mt-4 border-t pt-2 font-bold text-lg"><span>Total:</span><span id="final-cost-result" class="text-red-600">0 ‚Ç¨</span></div></div></div></div>

    <script type="module" src="auth.js"></script>
</body>
</html>